# py正则表达式
### 写xls文件

**未解决分离host cookie_pair正则表达式**
**regex还有问题,因为无法确定tshark输出**
```python
#coding=utf-8

import re
#import xlrd
import xlwt

#输入输出的文件名
print("输入文件只含有cookie_pair等号分割的键值对")
fileopen = raw_input("file to open:")
xlsname = raw_input("file to save:")

#打开文件
file = open("/"+fileopen)

#读取文件
text = file.read()
#print text

#简单正则匹配筛出出cookie_pair名称得到arr数组
regex = r"\w*?(?==)"
pat = re.compile(regex)
arr = pat.findall(text)

#去除重复及空白字段,得最终cookie_pair名称brr数组
brr = list(set(arr))
#print brr
#print len(brr)
if '' in brr:
    brr.remove('')
print len(brr)
print brr

#匹配填写表格的cookie_pair字段crr数组
regex1 = r"\w*?=\w.*?(?=,)"
pat1 = re.compile(regex1)
crr = pat1.findall(text)
#print arr

#匹配输出crr每行等号个数
regex3 = r"(?<=\s)\w.*?(?=\s)"
pat3 = re.compile(regex3)
crr1 = pat3.findall(text)
crr2 = [0]*len(crr1)
for i in range (0,len(crr1)):
    crr2[i] = crr1[i].count('=')

#xlwt创建表单表格
xlsfile = xlwt.Workbook()
xlstable = xlsfile.add_sheet("cook_pair",cell_overwrite_ok=True)

#匹配crr数组的cookie_pair名称与brr的作对比得到col值
regex2 = r"\w.*?(?==)"
pat2 = re.compile(regex2)

#匹配text产生crr1 统计=个数产生crr2
regex3 = r"\s\w.*?(?!\/)\w.*?\s"

#初始化全局变量row col
row = 0
col = 0
countcrr2 = 0

#将brr数组cookie_pair名称写入第一行即row=0的行
for i in range (0,len(brr)):
    xlstable.write(0,i,brr[i])

#匹配crr数组cookie_pair名称与row=0的行的brr数组名称得到col值
for i in range (0,len(crr)):
    match = re.match(regex2,crr[i])
    cookie_name = match.group(0)
    if i < crr2[countcrr2]:
        row += 1
        countcrr2 += 1
    for j in range (0,len(brr)):
        if cookie_name == brr[j]:
            col = j
            xlstable.write(row,col,crr[i])

#row的计算有一点小问题因为brr的长度并不是crr每一个包cookie_pair的长度
#可能会导致上一个包的字段存到下一行
#应该将crr数组正则匹配存为二维数组
#或者直接匹配用另一个数组存crr每row cookie_pair的个数
#匹配text的\s = \s为一个数组crr1 ,再统计其中=的个数即可为crr2,col在i每到crr2的值就增一

#粗糙做法
#    row = i%len(brr)
#    xlstable.write(row,col,crr[i])
#保存文件
xlsfile.save(xlsname)

```
input() py3
raw_input() py2
#coding=utf-8 #=周围不能空格
```python
#coding=utf-8

import re
#import xlrd
import xlwt

#输入输出的文件名
# print("输入文件只含有cookie_pair等号分割的键值对,且2文件首末加,号")
# fileopen = raw_input("file to open:")
# xlsname = raw_input("file to save:")
#
# #打开文件
# file = open("/"+fileopen)

#测试
file = open("/jd_view_userA03241323.txt")
xlsname = "jd_view_userA03241323.xls"

#读取文件
text = file.read()

#print text

#简单正则匹配筛出出cookie_pair名称得到arr数组
# regex = r"\w*?(?==)"
regex = r"(?<=,)\w.*?(?==)"
pat = re.compile(regex)
brr = pat.findall(text)

#去除重复及空白字段,得最终cookie_pair名称brr数组
# brr = list(set(arr))
# #print brr
# #print len(brr)
# if '' in brr:
#     brr.remove('')
# print len(brr)
#print brr

#匹配填写表格的cookie_pair字段crr数组
#regex1 = r"\w*?=\w.*?(?=,)"
regex1 = r"(?<=,)\w.*?(?=,)"
pat1 = re.compile(regex1)
crr = pat1.findall(text)
#print arr

#匹配输出crr每行等号个数
#regex3 = r"(?<=\s)\w.*?(?=\s)"
regex3 = r"(?<=,)\w.*?(?=\s)"
pat3 = re.compile(regex3)
crr1 = pat3.findall(text)
crr2 = [0]*len(crr1)
for i in range (0,len(crr1)):
    crr2[i] = crr1[i].count('=')

#xlwt创建表单表格
xlsfile = xlwt.Workbook()
xlstable = xlsfile.add_sheet("cook_pair",cell_overwrite_ok=True)

#匹配crr数组的cookie_pair名称与brr的作对比得到col值
regex2 = r"\w.*?(?==)"
#regex2 = r""
pat2 = re.compile(regex2)

#匹配text产生crr1 统计=个数产生crr2
#regex3 = r"\s\w.*?(?!\/)\w.*?\s"

#初始化全局变量row col
row = 1
col = 0
countcrr2 = 0
def sumcrr2(count):
    if count == 0:
        return crr2[0]
    else:
        return crr2[count]+crr2[count-1]

#将brr数组cookie_pair名称写入第一行即row=0的行
for i in range (0,len(brr)):
    xlstable.write(0,i,brr[i])

#匹配crr数组cookie_pair名称与row=0的行的brr数组名称得到col值
for i in range (0,len(crr)):
    match = re.match(regex2,crr[i])
    cookie_name = match.group(0)
    if i > sumcrr2(countcrr2):
        row += 1
        countcrr2 += 1
    for j in range (0,len(brr)):
        if cookie_name == brr[j]:
            col = j
            xlstable.write(row, col, crr[i])

print countcrr2
print sumcrr2(countcrr2)
#row的计算有一点小问题因为brr的长度并不是crr每一个包cookie_pair的长度
#可能会导致上一个包的字段存到下一行
#应该将crr数组正则匹配存为二维数组
#或者直接匹配用另一个数组存crr每row cookie_pair的个数
#匹配text的\s = \s为一个数组crr1 ,再统计其中=的个数即可为crr2,col在i每到crr2的值就增一

#    row = i%len(brr)
# xlstable.write(row,col,crr[i])

#保存文件
xlsfile.save(xlsname)


```
